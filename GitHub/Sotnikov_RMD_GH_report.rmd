---
title: "RMD report"
author: "Bogdan Sotnikov"
date: '2023-09-09'
output: 
  word_document:
    toc: yes
    toc_depth: 5
toc_title: "Contents"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      error = FALSE,
                      warning = FALSE,
                      message = FALSE,
                      fig.align = "center")

package_installer <- function(package){
  if (!require(package, character.only=T, quietly=T)) {
    install.packages(package, repos = "http://cran.us.r-project.org")
    library(package, character.only=T)
  }else{library(package, character.only=T)}
}

lapply(c("stringr",
         "glue",
         "car",
         "hash",
         "readr",
         "readxl",
         "tidyr",
         "flextable",
         "tibble",
         "haven",
         "psych",
         "knitr",
         "ggplot2",
         "dplyr"), package_installer)

se <- function(x){
  se_mean <- sd(x)/sqrt(length(x))
  return(se_mean)
}
```


## Загрузка данных ####

```{r}
blood_tsv <- read_tsv("./data/data_tsv.tsv")
blood_csv <- read_csv("./data/data_csv.csv")
blood_csv2 <- read_csv2("./data/data_csv2.csv")
write_rds(blood_tsv, "./data/data_rds.rds")
blood <- read_rds("./data/data_rds.rds")
blood
```


## Детекция расы

Раз пошла такая пьянка и есть "чанки которые правят всеми", то расклассифицируем респондентов по их расе в соответствии с легндариумом Дж.Р.Р. Толкина и средние показатели анализа крови у гномов на первом приеме.

```{r}
blood <- blood |> 
  mutate(ID = row_number())

blood |>
  mutate(`Раса` = case_when(
    `Рост` < 150 ~ "Хоббит",
    between(`Рост`, 150, 160) ~ "Гном",
    between(`Рост`, 160, 170) ~ "Человек",
    between(`Рост`, 170, 180) ~ "Эльф",
    `Рост` > 180 ~ "Энт"
  ) |> as.factor()) |> 
  filter(`Группа крови` %in% c("A (II)", "B (III)")) |> 
  select(`Раса`, where(is.numeric) & !contains("E1")) |> 
  group_by(`Раса`) |> 
  summarise(across(everything(), mean)) |> 
  slice_head(prop = 0.5)
```
Эозинофилы в норме, аллергические состояния или гельминтозы маловероятны (если приведены проценты, конечно, а не абсолютные значения).
